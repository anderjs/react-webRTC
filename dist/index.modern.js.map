{"version":3,"file":"index.modern.js","sources":["../src/hooks/useLocalPeerConnection/index.tsx","../src/hooks/useRemotePeerConnection/index.tsx","../src/hooks/useMediaDevices/index.tsx","../src/hooks/useRTCIceCandidate/index.ts","../src/components/Adapter/index.tsx","../src/components/WebRTCAdapter/index.tsx","../src/components/RTCPeerConnection/index.tsx"],"sourcesContent":["/* eslint-disable prettier/prettier */\r\nimport { createContext, useContext } from 'react'\r\n\r\n\r\nfunction useLocalPeerConnection () {\r\n  const peerConnection = useContext(PeerLocalContext)\r\n\r\n  return peerConnection\r\n}\r\n\r\nexport const PeerLocalContext = createContext(new RTCPeerConnection())\r\n\r\n\r\nexport default useLocalPeerConnection","/* eslint-disable prettier/prettier */\r\nimport { createContext, useContext } from 'react'\r\n\r\n\r\nfunction useRemotePeerConnection () {\r\n  const peerConnection = useContext(PeerRemoteContext)\r\n\r\n  return peerConnection\r\n}\r\n\r\nexport const PeerRemoteContext = createContext(new RTCPeerConnection())\r\n\r\n\r\nexport default useRemotePeerConnection","/* eslint-disable prettier/prettier */\r\nimport { useState, useEffect } from 'react'\r\n\r\ninterface MediaDevicesHook {\r\n  localMediaStream: MediaStream | null\r\n  error: Error | null\r\n}\r\n\r\n\r\nfunction useMediaDevices(constraints?: MediaStreamConstraints): MediaDevicesHook {\r\n  const [localMediaStream, setLocalMediaStream] = useState<MediaStream | null>(\r\n    null\r\n  )\r\n\r\n  const [error, setError] = useState<Error | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (navigator?.mediaDevices?.getUserMedia) {\r\n      navigator.mediaDevices\r\n        .getUserMedia(constraints)\r\n        .then(setLocalMediaStream)\r\n        .catch(setError)\r\n    } else {\r\n      const err = new Error(\r\n        'Unsupoorted mediaDevices see: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices'\r\n      )\r\n\r\n      setError(err)\r\n    }\r\n  }, [])\r\n\r\n  return {\r\n    localMediaStream,\r\n    error\r\n  }\r\n}\r\n\r\nexport default useMediaDevices\r\n","/* eslint-disable prettier/prettier */\r\n\r\n\r\nfunction useRTCIceCandidate () {\r\n  function handleICECandidateConnection (event: RTCPeerConnectionIceEvent) {\r\n    const connection = event.target\r\n\r\n    const iceCandidate = event.candidate\r\n\r\n    if (iceCandidate) {\r\n      const newIceCandidate = new RTCIceCandidate(iceCandidate);\r\n\r\n      console.debug(newIceCandidate.usernameFragment)\r\n\r\n      return {\r\n        connection,\r\n        newIceCandidate\r\n      }\r\n    }\r\n    \r\n    return null\r\n  }\r\n\r\n  return {\r\n    handleICECandidateConnection\r\n  }\r\n}\r\n\r\n\r\nexport default useRTCIceCandidate","/* eslint-disable prettier/prettier */\r\nimport React from 'react'\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n}\r\n\r\nconst Adapter: React.FunctionComponent<Props> = ({ children }) => {\r\n  React.useEffect(() => {\r\n    const script = document.createElement('script')\r\n\r\n    script.src = \"https://webrtc.github.io/adapter/adapter-latest.js\"\r\n\r\n    document.body.appendChild(script)\r\n  }, [])\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {children}\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default Adapter","/* eslint-disable prettier/prettier */\r\nimport React, { memo, useState } from 'react'\r\n\r\nimport { PeerLocalContext } from 'hooks/useLocalPeerConnection'\r\nimport { PeerRemoteContext } from 'hooks/useRemotePeerConnection'\r\n\r\nimport Adapter from 'components/Adapter'\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n  localPeerConfiguration?: RTCConfiguration\r\n  remotePeerConfiguration?: RTCConfiguration\r\n}\r\n\r\nconst WebRTCAdapter: React.FunctionComponent<Props> = ({\r\n  children,\r\n  localPeerConfiguration,\r\n  remotePeerConfiguration\r\n}) => {\r\n  const [localPeerConnection] = useState(\r\n    new RTCPeerConnection(localPeerConfiguration)\r\n  )\r\n\r\n  const [remotePeerConnection] = useState(\r\n    new RTCPeerConnection(remotePeerConfiguration)\r\n  )\r\n\r\n  return (\r\n    <Adapter>\r\n      <PeerLocalContext.Provider value={localPeerConnection}>\r\n        <PeerRemoteContext.Provider value={remotePeerConnection}>\r\n          {children}\r\n        </PeerRemoteContext.Provider>\r\n      </PeerLocalContext.Provider>\r\n    </Adapter>\r\n  )\r\n}\r\n\r\nexport default memo(WebRTCAdapter)\r\n","/* eslint-disable prettier/prettier */\r\nimport React from 'react'\r\n\r\nimport useLocalPeerConnection from 'hooks/useLocalPeerConnection'\r\nimport useRemotePeerConnection from 'hooks/useRemotePeerConnection'\r\n\r\ninterface Props {\r\n  onSuccessHandleCandidate?: () => void\r\n  onErrorHandleCanidate?: () => void\r\n}\r\n\r\nconst RTCPeerConnectionHandler: React.FunctionComponent<Props> = props => {\r\n  const localPeerConnection = useLocalPeerConnection()\r\n\r\n  const remotePeerConnection = useRemotePeerConnection()\r\n\r\n  async function handleConnectionSuccess(event: RTCPeerConnectionIceEvent) {\r\n    const peerConnection = event?.target\r\n\r\n    const iceCandidate = event?.candidate\r\n\r\n    if (iceCandidate) {\r\n      const newIceCandidate = new RTCIceCandidate(iceCandidate)\r\n\r\n      const getOutgoingPeer = getPeerConnectionHandler(peerConnection)\r\n\r\n      try {\r\n        await getOutgoingPeer.addIceCandidate(newIceCandidate)\r\n\r\n        props.onSuccessHandleCandidate && props.onSuccessHandleCandidate()\r\n      } catch (err) {\r\n        props.onErrorHandleCanidate && props.onErrorHandleCanidate()\r\n      }\r\n    }\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    localPeerConnection.addEventListener('icecandidate', handleConnectionSuccess)\r\n\r\n    remotePeerConnection.addEventListener('icecandidate', handleConnectionSuccess)\r\n  }, [])\r\n\r\n  const getPeerConnectionHandler = (peerConnection: EventTarget | null) => {\r\n    return peerConnection === localPeerConnection\r\n      ? remotePeerConnection\r\n      : localPeerConnection\r\n  }\r\n\r\n  return <React.Fragment>{props.children}</React.Fragment>\r\n}\r\n\r\nexport default RTCPeerConnectionHandler\r\n"],"names":["useLocalPeerConnection","peerConnection","useContext","PeerLocalContext","createContext","RTCPeerConnection","useRemotePeerConnection","PeerRemoteContext","useMediaDevices","constraints","localMediaStream","setLocalMediaStream","useState","error","setError","useEffect","navigator","mediaDevices","getUserMedia","then","catch","err","Error","useRTCIceCandidate","handleICECandidateConnection","event","connection","target","iceCandidate","candidate","newIceCandidate","RTCIceCandidate","console","debug","usernameFragment","Adapter","children","React","script","document","createElement","src","body","appendChild","Fragment","WebRTCAdapter","localPeerConfiguration","remotePeerConfiguration","localPeerConnection","remotePeerConnection","Provider","value","memo","RTCPeerConnectionHandler","props","handleConnectionSuccess","getOutgoingPeer","getPeerConnectionHandler","addIceCandidate","onSuccessHandleCandidate","onErrorHandleCanidate","addEventListener"],"mappings":"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"}