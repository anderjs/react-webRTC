{"version":3,"file":"index.modern.js","sources":["../src/context/index.tsx","../src/hooks/useWebRTCAdapterState/index.ts","../src/hooks/useLocalPeerConnection/index.tsx","../src/hooks/useRemotePeerConnection/index.tsx","../src/hooks/useMediaDevices/index.tsx","../src/hooks/useRTCIceCandidate/index.ts","../src/components/Adapter/index.tsx","../src/components/WebRTCAdapter/index.tsx","../src/components/RTCPeerConnection/index.tsx"],"sourcesContent":["/* eslint-disable prettier/prettier */\r\nimport { createContext } from 'react'\r\n\r\nexport interface WebRTCAdapterContext {\r\n  remotePeerConnection: RTCPeerConnection\r\n  localPeerConnection: RTCPeerConnection\r\n  localMediaStream?: MediaStream | null\r\n  getUserMedia?: (constraints: MediaStreamConstraints) => Promise<MediaStream | null>\r\n}\r\n\r\nconst RTC = createContext<WebRTCAdapterContext>({\r\n  remotePeerConnection: new RTCPeerConnection(),\r\n  localPeerConnection: new RTCPeerConnection(),\r\n})\r\n\r\nexport default RTC","/* eslint-disable prettier/prettier */\r\nimport { useContext } from 'react'\r\n\r\nimport RTC from 'context'\r\n\r\nfunction useWebRTCAdapterState () {\r\n  const state = useContext(RTC)\r\n  \r\n  return state\r\n}\r\n\r\nexport default useWebRTCAdapterState","/* eslint-disable prettier/prettier */\r\nimport useWebRTCAdapterState from 'hooks/useWebRTCAdapterState'\r\n\r\n\r\n\r\nfunction useLocalPeerConnection () {\r\n  const { localPeerConnection } = useWebRTCAdapterState()\r\n\r\n  return localPeerConnection\r\n}\r\n\r\n\r\nexport default useLocalPeerConnection","/* eslint-disable prettier/prettier */\r\nimport useWebRTCAdapterState from 'hooks/useWebRTCAdapterState'\r\n\r\n\r\nfunction useRemotePeerConnection () {\r\n  const { remotePeerConnection } = useWebRTCAdapterState()\r\n\r\n  return remotePeerConnection\r\n}\r\n\r\n\r\nexport default useRemotePeerConnection","/* eslint-disable prettier/prettier */\r\nimport { useState, useEffect } from 'react'\r\n\r\ninterface MediaDevicesHook {\r\n  localMediaStream: MediaStream | null\r\n  error: Error | null\r\n}\r\n\r\n\r\nfunction useMediaDevices(constraints?: MediaStreamConstraints): MediaDevicesHook {\r\n  const [localMediaStream, setLocalMediaStream] = useState<MediaStream | null>(\r\n    null\r\n  )\r\n\r\n  const [error, setError] = useState<Error | null>(null)\r\n\r\n  useEffect(() => {\r\n    if (navigator?.mediaDevices?.getUserMedia) {\r\n      navigator.mediaDevices\r\n        .getUserMedia(constraints)\r\n        .then(setLocalMediaStream)\r\n        .catch(setError)\r\n    } else {\r\n      const err = new Error(\r\n        'Unsupoorted mediaDevices see: https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices'\r\n      )\r\n\r\n      setError(err)\r\n    }\r\n  }, [])\r\n\r\n  return {\r\n    localMediaStream,\r\n    error\r\n  }\r\n}\r\n\r\nexport default useMediaDevices\r\n","/* eslint-disable prettier/prettier */\r\n\r\n\r\nfunction useRTCIceCandidate () {\r\n  function handleICECandidateConnection (event: RTCPeerConnectionIceEvent) {\r\n    const connection = event.target\r\n\r\n    const iceCandidate = event.candidate\r\n\r\n    if (iceCandidate) {\r\n      const newIceCandidate = new RTCIceCandidate(iceCandidate);\r\n\r\n      console.debug(newIceCandidate.usernameFragment)\r\n\r\n      return {\r\n        connection,\r\n        newIceCandidate\r\n      }\r\n    }\r\n    \r\n    return null\r\n  }\r\n\r\n  return {\r\n    handleICECandidateConnection\r\n  }\r\n}\r\n\r\n\r\nexport default useRTCIceCandidate","/* eslint-disable prettier/prettier */\r\nimport React from 'react'\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n}\r\n\r\nconst Adapter: React.FunctionComponent<Props> = ({ children }) => {\r\n  React.useEffect(() => {\r\n    const script = document.createElement('script')\r\n\r\n    script.src = \"https://webrtc.github.io/adapter/adapter-latest.js\"\r\n\r\n    document.body.appendChild(script)\r\n  }, [])\r\n\r\n  return (\r\n    <React.Fragment>\r\n      {children}\r\n    </React.Fragment>\r\n  )\r\n}\r\n\r\nexport default Adapter","/* eslint-disable prettier/prettier */\r\nimport React, { memo, useState, useMemo } from 'react'\r\n\r\n\r\nimport Adapter from 'components/Adapter'\r\n\r\nimport RTC from 'context'\r\n\r\ninterface Props {\r\n  children: React.ReactNode\r\n  localPeerConfiguration?: RTCConfiguration\r\n  remotePeerConfiguration?: RTCConfiguration\r\n}\r\n\r\nconst WebRTCAdapter: React.FunctionComponent<Props> = ({\r\n  children,\r\n  localPeerConfiguration,\r\n  remotePeerConfiguration\r\n}) => {\r\n  const [localPeerConnection] = useState(\r\n    new RTCPeerConnection(localPeerConfiguration)\r\n  )\r\n\r\n  const [remotePeerConnection] = useState(\r\n    new RTCPeerConnection(remotePeerConfiguration)\r\n  )\r\n\r\n  const [localMediaStream, setLocalMediaStream] = useState<MediaStream | null>(null)\r\n\r\n  async function getUserMedia (constraints: MediaStreamConstraints) {\r\n    if (navigator?.mediaDevices?.getUserMedia) {\r\n      const stream = await navigator.mediaDevices.getUserMedia(constraints)\r\n\r\n      setLocalMediaStream(stream)\r\n\r\n      return stream\r\n    }\r\n    return null\r\n  }\r\n\r\n  const memo = useMemo(() => {\r\n    return {\r\n      localPeerConnection,\r\n      remotePeerConnection,\r\n      localMediaStream,\r\n      getUserMedia\r\n    }\r\n  }, [])\r\n\r\n  return (\r\n    <Adapter>\r\n      <RTC.Provider value={memo}>\r\n        {children}\r\n      </RTC.Provider>\r\n    </Adapter>\r\n  )\r\n}\r\n\r\nexport default memo(WebRTCAdapter)\r\n","/* eslint-disable prettier/prettier */\r\nimport React from 'react'\r\n\r\nimport useLocalPeerConnection from 'hooks/useLocalPeerConnection'\r\nimport useRemotePeerConnection from 'hooks/useRemotePeerConnection'\r\n\r\ninterface Props {\r\n  onSuccessHandleCandidate?: () => void\r\n  onErrorHandleCanidate?: () => void\r\n  onConnectionStateChange?: () => void\r\n}\r\n\r\nconst RTCPeerConnectionHandler: React.FunctionComponent<Props> = props => {\r\n  const localPeerConnection = useLocalPeerConnection()\r\n\r\n  const remotePeerConnection = useRemotePeerConnection()\r\n\r\n  async function handleConnectionSuccess(event: RTCPeerConnectionIceEvent) {\r\n    const peerConnection = event?.target\r\n\r\n    const iceCandidate = event?.candidate\r\n\r\n    if (iceCandidate) {\r\n      const newIceCandidate = new RTCIceCandidate(iceCandidate)\r\n\r\n      const getOutgoingPeer = getPeerConnectionHandler(peerConnection)\r\n\r\n      try {\r\n        await getOutgoingPeer.addIceCandidate(newIceCandidate)\r\n\r\n        props.onSuccessHandleCandidate && props.onSuccessHandleCandidate()\r\n      } catch (err) {\r\n        props.onErrorHandleCanidate && props.onErrorHandleCanidate()\r\n      }\r\n    }\r\n  }\r\n\r\n  function handleConnectionChange(event: RTCPeerConnectionIceEvent) {\r\n    console.trace(`${getPeerName(event.target)} ICE State: null`)\r\n\r\n    if (props.onConnectionStateChange) {\r\n      props.onConnectionStateChange()\r\n    }\r\n  }\r\n\r\n  function getPeerName(peerConnection: EventTarget | null): string {\r\n    return peerConnection === localPeerConnection\r\n      ? 'localPeerConnection'\r\n      : 'remotePeerConnection'\r\n  }\r\n\r\n  React.useEffect(() => {\r\n    localPeerConnection.addEventListener(\r\n      'icecandidate',\r\n      handleConnectionSuccess\r\n    )\r\n    localPeerConnection.addEventListener(\r\n      'iceconnectionstatechange',\r\n      handleConnectionChange\r\n    )\r\n\r\n    remotePeerConnection.addEventListener(\r\n      'icecandidate',\r\n      handleConnectionSuccess\r\n    )\r\n    remotePeerConnection.addEventListener(\r\n      'iceconnectionstatechange',\r\n      handleConnectionChange\r\n    )\r\n  }, [])\r\n\r\n  const getPeerConnectionHandler = (peerConnection: EventTarget | null) => {\r\n    return peerConnection === localPeerConnection\r\n      ? remotePeerConnection\r\n      : localPeerConnection\r\n  }\r\n\r\n  return <React.Fragment>{props.children}</React.Fragment>\r\n}\r\n\r\nexport default RTCPeerConnectionHandler\r\n"],"names":["RTC","createContext","remotePeerConnection","RTCPeerConnection","localPeerConnection","useWebRTCAdapterState","state","useContext","useLocalPeerConnection","useRemotePeerConnection","useMediaDevices","constraints","localMediaStream","setLocalMediaStream","useState","error","setError","useEffect","navigator","mediaDevices","getUserMedia","then","catch","err","Error","useRTCIceCandidate","handleICECandidateConnection","event","connection","target","iceCandidate","candidate","newIceCandidate","RTCIceCandidate","console","debug","usernameFragment","Adapter","children","React","script","document","createElement","src","body","appendChild","Fragment","WebRTCAdapter","localPeerConfiguration","remotePeerConfiguration","stream","memo","useMemo","Provider","value","RTCPeerConnectionHandler","props","handleConnectionSuccess","peerConnection","getOutgoingPeer","getPeerConnectionHandler","addIceCandidate","onSuccessHandleCandidate","onErrorHandleCanidate","handleConnectionChange","trace","getPeerName","onConnectionStateChange","addEventListener"],"mappings":"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"}